<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCM êµ¬ë§¤ë³¸ë¶€ ê²½ì˜í˜„í™© 2026ë…„</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #f0f2f5;
    --card: #ffffff;
    --card-hover: #fafbfc;
    --border: #e0e4e8;
    --text: #1a2332;
    --text-sub: #6b7a8d;
    --accent: #1976d2;
    --accent2: #2e7d32;
    --accent3: #e65100;
    --accent4: #c62828;
    --accent5: #7b1fa2;
    --positive: #2e7d32;
    --negative: #c62828;
    --warning: #e65100;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 16px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .header {
    text-align: center;
    padding: 16px 0 8px;
    border-bottom: 2px solid var(--border);
    margin-bottom: 14px;
  }
  .header h1 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
  }
  .header .subtitle {
    color: var(--text-sub);
    font-size: 12px;
    margin-top: 4px;
  }
  .header .update-info {
    color: var(--text-sub);
    font-size: 11px;
    margin-top: 2px;
  }

  /* KPI Cards */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 14px;
  }
  .kpi-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 18px 20px;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  }
  .kpi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(25,118,210,0.15);
    border-color: var(--accent);
    background: linear-gradient(135deg, rgba(25,118,210,0.03), rgba(25,118,210,0.06));
  }
  .kpi-card .kpi-label {
    font-size: 11px;
    color: var(--text-sub);
    font-weight: 600;
    letter-spacing: 0.3px;
  }
  .kpi-card .kpi-value {
    font-size: 26px;
    font-weight: 700;
    margin: 6px 0 4px;
  }
  .kpi-card .kpi-sub {
    font-size: 11px;
    color: var(--text-sub);
  }
  .kpi-card .kpi-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 600;
    margin-top: 3px;
  }
  .kpi-card .kpi-icon {
    position: absolute;
    top: 14px;
    right: 16px;
    font-size: 26px;
    opacity: 0.12;
  }
  .kpi-detail {
    margin-top: 10px;
    border-top: 1px solid var(--border);
    padding-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  .kpi-detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
  }
  .kpi-detail-label {
    color: var(--text-sub);
    font-weight: 500;
  }
  .kpi-detail-value {
    font-weight: 600;
    color: var(--text);
  }
  .badge-good { background: rgba(46,125,50,0.1); color: var(--positive); }
  .badge-warn { background: rgba(230,81,0,0.1); color: var(--warning); }
  .badge-bad { background: rgba(198,40,40,0.1); color: var(--negative); }
  .kpi-accent1 { border-left: 3px solid var(--accent); }
  .kpi-accent2 { border-left: 3px solid var(--accent2); }
  .kpi-accent3 { border-left: 3px solid var(--accent3); }
  .kpi-accent4 { border-left: 3px solid var(--accent4); }
  .kpi-accent5 { border-left: 3px solid var(--accent5); }

  /* Section */
  .section {
    margin-bottom: 14px;
  }
  .section-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    padding-left: 10px;
    border-left: 3px solid var(--accent);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .section-title .tag {
    font-size: 9px;
    background: rgba(25,118,210,0.08);
    color: var(--accent);
    padding: 1px 6px;
    border-radius: 6px;
    font-weight: 500;
  }

  /* Chart Grid */
  .chart-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }
  .chart-grid.cols-3 {
    grid-template-columns: repeat(3, 1fr);
  }
  .chart-grid.cols-1 {
    grid-template-columns: 1fr;
  }
  .chart-box {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 14px;
    transition: box-shadow 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  }
  .chart-box:hover {
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }
  .chart-box.wide {
    grid-column: span 2;
  }
  .chart-box h3 {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
  }
  .chart-box h3 span {
    font-weight: 400;
    color: var(--text-sub);
    font-size: 10px;
    margin-left: 4px;
  }
  .chart-container {
    position: relative;
    width: 100%;
    height: 200px;
  }
  .chart-container.tall {
    height: 240px;
  }
  .inv-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    align-items: stretch;
  }
  .inv-row > .chart-box {
    display: flex;
    flex-direction: column;
  }
  .inv-row > .chart-box .chart-container {
    flex: 1;
    height: auto;
    min-height: 0;
  }
  .chart-box-stack {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .chart-box-stack .chart-box.compact {
    flex: 1;
    padding: 10px 14px;
    display: flex;
    flex-direction: column;
  }
  .chart-box-stack .chart-box.compact h3 {
    margin-bottom: 4px;
  }
  .chart-box-stack .chart-box.compact .chart-container {
    flex: 1;
    height: auto;
    min-height: 0;
  }

  /* Table Styles */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }
  .data-table th {
    background: rgba(25,118,210,0.06);
    color: var(--accent);
    padding: 6px 8px;
    text-align: right;
    font-weight: 600;
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
  }
  .data-table th:first-child,
  .data-table th:nth-child(2) {
    text-align: left;
  }
  .data-table td {
    padding: 5px 8px;
    text-align: right;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }
  .data-table td:first-child,
  .data-table td:nth-child(2) {
    text-align: left;
    font-weight: 500;
  }
  .data-table tr:hover td {
    background: rgba(25,118,210,0.03);
  }
  .val-pos { color: var(--positive); }
  .val-neg { color: var(--negative); }
  .val-warn { color: var(--warning); }

  /* Toolbar */
  .toolbar {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-bottom: 10px;
  }
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 6px 14px;
    font-size: 11px;
    font-weight: 600;
    font-family: 'Noto Sans KR', sans-serif;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.15s;
    background: var(--card);
    color: var(--text);
  }
  .btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }
  .btn-upload { color: var(--accent2); border-color: var(--accent2); }
  .btn-upload:hover { background: rgba(46,125,50,0.06); }
  .btn-download { color: var(--accent); border-color: var(--accent); }
  .btn-download:hover { background: rgba(25,118,210,0.06); }
  .btn svg { width: 14px; height: 14px; fill: currentColor; }
  #fileInput { display: none; }

  /* Tab Navigation */
  .tab-nav {
    display: flex;
    gap: 4px;
    margin-bottom: 14px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 0;
  }
  .tab-btn {
    padding: 8px 20px;
    font-size: 12px;
    font-weight: 600;
    font-family: 'Noto Sans KR', sans-serif;
    color: var(--text-sub);
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .tab-btn:hover {
    color: var(--accent);
    background: rgba(25,118,210,0.04);
  }
  .tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }
  .tab-panel {
    display: none;
  }
  .tab-panel.active {
    display: block;
  }

  @media (max-width: 900px) {
    .chart-grid { grid-template-columns: 1fr; }
    .chart-box.wide { grid-column: span 1; }
    .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    .tab-btn { padding: 6px 12px; font-size: 11px; }
  }
  @media (max-width: 600px) {
    .kpi-grid { grid-template-columns: 1fr; }
    body { padding: 8px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>SCM êµ¬ë§¤ë³¸ë¶€ ê²½ì˜í˜„í™© 2026ë…„</h1>
  <div class="subtitle">Monthly Performance Dashboard</div>
  <div class="update-info">Data: 2026ë…„ 1ì›” ì‹¤ë§ˆê° ê¸°ì¤€ | ì „ë…„(2025) ì‹¤ì  ëŒ€ë¹„</div>
</div>

<!-- Hidden file input -->
<input type="file" id="fileInput" accept=".xlsx,.xls">

<!-- Tab Navigation -->
<div class="tab-nav">
  <button class="tab-btn active" data-tab="summary">ìš”ì•½</button>
  <button class="tab-btn" data-tab="inventory">ì¬ê³ í˜„í™©</button>
  <button class="tab-btn" data-tab="tcr">TCR</button>
  <button class="tab-btn" data-tab="comp">ë³´ìƒ / ì‚¬ìš©ì†Œì§„</button>
  <button class="tab-btn" data-tab="etc">ê¸°íƒ€</button>
</div>

<!-- ìš”ì•½ -->
<div class="tab-panel active" id="panel-summary">
  <div class="toolbar">
    <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>ì—‘ì…€ ì—…ë¡œë“œ</button>
    <button class="btn btn-download" onclick="downloadSection('summary')"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="kpi-grid" id="kpiGrid"></div>
</div>

<!-- ì¬ê³ í˜„í™© -->
<div class="tab-panel" id="panel-inventory">
  <div class="toolbar">
    <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>ì—‘ì…€ ì—…ë¡œë“œ</button>
    <button class="btn btn-download" onclick="downloadSection('inventory')"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="section">
    <div class="section-title">ì¬ê³ ê¸ˆì•¡ ì¶”ì´ <span class="tag">Inventory</span></div>
    <div class="inv-row" style="height:420px;">
      <div class="chart-box">
        <h3>SCM ì´ ì¬ê³ ê¸ˆì•¡ ì¶”ì´ <span>(ì–µì›, ì›ë£Œ+ë¶€ìì¬ í•©ì‚°)</span></h3>
        <div class="chart-container"><canvas id="chartInventoryTotal"></canvas></div>
      </div>
      <div class="chart-box-stack">
        <div class="chart-box compact">
          <h3>ì›ë£Œ ì¬ê³ ê¸ˆì•¡ ì¶”ì´ <span>(ì–µì›)</span></h3>
          <div class="chart-container"><canvas id="chartInvRaw"></canvas></div>
        </div>
        <div class="chart-box compact">
          <h3>ë¶€ìì¬ ì¬ê³ ê¸ˆì•¡ ì¶”ì´ <span>(ì–µì›)</span></h3>
          <div class="chart-container"><canvas id="chartInvSub"></canvas></div>
        </div>
      </div>
    </div>
    <div class="chart-grid cols-3" style="margin-top:10px;">
      <div class="chart-box">
        <h3>SCM ì¬ê³  êµ¬ì„±ë¹„ <span>(í•©ì‚°)</span></h3>
        <div class="chart-container"><canvas id="chartInventoryCompo"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì›ë£Œ ì¬ê³  êµ¬ì„±ë¹„</h3>
        <div class="chart-container"><canvas id="chartCompoRaw"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ë¶€ìì¬ ì¬ê³  êµ¬ì„±ë¹„</h3>
        <div class="chart-container"><canvas id="chartCompoSub"></canvas></div>
      </div>
    </div>
    <div class="chart-grid cols-1" style="margin-top:10px;">
      <div class="chart-box">
        <h3>êµ¬ë§¤ vs ì¶œê³  ê¸ˆì•¡ <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartPurchaseRelease"></canvas></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">OKR - ë¶€ë™ì¬ê³  <span class="tag">Idle Inventory</span></div>
    <div class="chart-grid">
      <div class="chart-box wide">
        <h3>ë¶€ë™ì¬ê³  ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›, SCM ì „ì²´)</span></h3>
        <div class="chart-container"><canvas id="chartIdleInventory"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì›ë£Œ ë¶€ë™ì¬ê³  ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartIdleRaw"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ë¶€ìì¬ ë¶€ë™ì¬ê³  ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartIdleSub"></canvas></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">OKR - ì¬ê³ íšŒì „ì¼ <span class="tag">Inventory Turnover</span></div>
    <div class="chart-grid">
      <div class="chart-box wide">
        <h3>ì¬ê³ íšŒì „ì¼ ì¶”ì´ <span>(ì¼)</span></h3>
        <div class="chart-container"><canvas id="chartTurnover"></canvas></div>
      </div>
    </div>
  </div>
</div>

<!-- TCR -->
<div class="tab-panel" id="panel-tcr">
  <div class="toolbar">
    <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>ì—‘ì…€ ì—…ë¡œë“œ</button>
    <button class="btn btn-download" onclick="downloadSection('tcr')"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="section">
    <div class="section-title">OKR - TCR (Total Cost Reduction) <span class="tag">Cost Saving</span></div>
    <div class="chart-grid">
      <div class="chart-box">
        <h3>TCR ì „ì²´ ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartTCR"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>TCR ì›ë£Œ ìƒì„¸ <span>(ì–µì›, ì¸ìƒ/ì¸í•˜/ëŒ€ì²´)</span></h3>
        <div class="chart-container"><canvas id="chartTCRRaw"></canvas></div>
      </div>
    </div>
  </div>
</div>

<!-- ë³´ìƒ/ì‚¬ìš©ì†Œì§„ -->
<div class="tab-panel" id="panel-comp">
  <div class="toolbar">
    <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>ì—‘ì…€ ì—…ë¡œë“œ</button>
    <button class="btn btn-download" onclick="downloadSection('comp')"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="section">
    <div class="section-title">OKR - ë³´ìƒ / ì‚¬ìš©ì†Œì§„ <span class="tag">Compensation</span></div>
    <div class="chart-grid">
      <div class="chart-box">
        <h3>ë³´ìƒ ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartCompensation"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì‚¬ìš©ì†Œì§„(ë¶€ìì¬) ëª©í‘œ vs ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartConsumption"></canvas></div>
      </div>
    </div>
  </div>
</div>

<!-- ê¸°íƒ€ -->
<div class="tab-panel" id="panel-etc">
  <div class="toolbar">
    <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>ì—‘ì…€ ì—…ë¡œë“œ</button>
    <button class="btn btn-download" onclick="downloadSection('etc')"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="section">
    <div class="section-title">ìì²´íê¸° / ì›ë‚©ê¸° <span class="tag">Disposal</span></div>
    <div class="chart-grid cols-3">
      <div class="chart-box">
        <h3>ìì²´íê¸° ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container"><canvas id="chartDisposal"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì›ë‚©ê¸° ì¤€ìˆ˜ìœ¨ <span>(%)</span></h3>
        <div class="chart-container"><canvas id="chartOntime"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì›ë‚©ê¸° ë¯¸ì¤€ìˆ˜ ê±´ìˆ˜</h3>
        <div class="chart-container"><canvas id="chartOntimeCount"></canvas></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">í•´ì™¸ë²•ì¸ ë§¤ì¶œ <span class="tag">Overseas Sales</span></div>
    <div class="chart-grid">
      <div class="chart-box wide">
        <h3>í•´ì™¸ë²•ì¸ ì›”ë³„ ë§¤ì¶œ ì‹¤ì  <span>(ì–µì›)</span></h3>
        <div class="chart-container tall"><canvas id="chartOverseas"></canvas></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">ë°œì£¼ê±´ìˆ˜ / ì¸ì›í˜„í™© <span class="tag">Operations</span></div>
    <div class="chart-grid">
      <div class="chart-box">
        <h3>ë¶€ì„œë³„ ë°œì£¼ê±´ìˆ˜ <span>(1ì›”)</span></h3>
        <div class="chart-container"><canvas id="chartOrders"></canvas></div>
      </div>
      <div class="chart-box">
        <h3>ì¸ë‹¹ ë°œì£¼ê±´ìˆ˜ / ì¸ì›í˜„í™©</h3>
        <div class="chart-container"><canvas id="chartHeadcount"></canvas></div>
      </div>
  </div>
</div>

<script>
// ===== DATA =====
const months = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
const B = 100000000; // ì–µì› ë‹¨ìœ„ ë³€í™˜

// ì¬ê³ í˜„í™© ë°ì´í„°
const data = {
  // ì´ êµ¬ë§¤ê¸ˆì•¡
  scmPurchase:   { prev: 856089879088, avg: 71340823257, m: [85256107903,0,0,0,0,0,0,0,0,0,0,0] },
  scmRelease:    { prev: 842571836943, avg: 70196670403, m: [75235511546,0,0,0,0,0,0,0,0,0,0,0] },
  scmInventory:  { prev: 74248280897,  avg: 75218412811, m: [84268144093,0,0,0,0,0,0,0,0,0,0,0],
    prev_m: [70633416241,79126307250,76695682017,84355936756,79814895786,74093763082,70923469500,69592977532,73741630874,77185572461,72209021331,74248280897] },
  // ì¬ê³  êµ¬ì„±
  invNormal:  { prev: 54543532326, m: [63684356437,0,0,0,0,0,0,0,0,0,0,0] },
  invSlow:    { prev: 8164600070,  m: [8344653635,0,0,0,0,0,0,0,0,0,0,0] },
  invDead:    { prev: 11540148501, m: [12239134021,0,0,0,0,0,0,0,0,0,0,0] },
  // ì›ìì¬ ì¬ê³ 
  rawInventory: { prev: 21356048905, m: [22794583786,0,0,0,0,0,0,0,0,0,0,0],
    prev_m: [18840270446,22825542445,23079130237,25107476494,21919146326,20549900245,19528779593,20126614372,20858976949,20979278992,22153588294,21356048905] },
  rawNormal:    { prev: 17658249579, m: [19183186398,0,0,0,0,0,0,0,0,0,0,0] },
  rawSlow:      { prev: 1573356114,  m: [1510659706,0,0,0,0,0,0,0,0,0,0,0] },
  rawDead:      { prev: 2124443212,  m: [2100737682,0,0,0,0,0,0,0,0,0,0,0] },
  // ë¶€ìì¬ ì¬ê³ 
  subInventory: { prev: 52892231992, m: [61473560307,0,0,0,0,0,0,0,0,0,0,0],
    prev_m: [51793145795,56300764805,53616551780,59248460262,57895749460,53543862837,51394689907,49466363160,52882653925,56206293469,50055433037,52892231992] },
  subNormal:    { prev: 36885282747, m: [44501170039,0,0,0,0,0,0,0,0,0,0,0] },
  subSlow:      { prev: 6591243956,  m: [6833993929,0,0,0,0,0,0,0,0,0,0,0] },
  subDead:      { prev: 9415705289,  m: [10138396339,0,0,0,0,0,0,0,0,0,0,0] },
  // ì›ìì¬ êµ¬ë§¤/ì¶œê³ 
  rawPurchase:  { prev: 280674738383, m: [29413844844,0,0,0,0,0,0,0,0,0,0,0] },
  rawRelease:   { prev: 276251691275, m: [27974576794,0,0,0,0,0,0,0,0,0,0,0] },
  subPurchase:  { prev: 575415140705, m: [55842263059,0,0,0,0,0,0,0,0,0,0,0] },
  subRelease:   { prev: 566320145668, m: [47260934752,0,0,0,0,0,0,0,0,0,0,0] },

  // OKR ë¶€ë™ì¬ê³ 
  idleSCM_target: [12150000000,13150000000,14150000000,13100000000,12600000000,12100000000,11600000000,11100000000,10600000000,10050000000,9550000000,9500000000],
  idleSCM_actual: [12239134021,0,0,0,0,0,0,0,0,0,0,0],
  idleSCM_prevFinal: 11540148501,
  idleRaw_target: [2150000000,2150000000,2150000000,2100000000,2100000000,2100000000,2100000000,2100000000,2100000000,2050000000,2050000000,2000000000],
  idleRaw_actual: [2100737682,0,0,0,0,0,0,0,0,0,0,0],
  idleSub_target: [10000000000,11000000000,12000000000,11000000000,10500000000,10000000000,9500000000,9000000000,8500000000,8000000000,7500000000,7500000000],
  idleSub_actual: [10138396339,0,0,0,0,0,0,0,0,0,0,0],

  // ì¬ê³ íšŒì „ì¼
  turnSCM_target: [34.77,34.02,33.27,33.27,32.52,32.27,31.52,31.52,30.76,30.64,29.89,29.01],
  turnSCM_actual: [32.78,0,0,0,0,0,0,0,0,0,0,0],
  turnSCM_prev: 33.82,
  turnRaw_target: [28,28,28,28,28,27,27,27,27,26.5,26.5,26],
  turnRaw_actual: [26.67,0,0,0,0,0,0,0,0,0,0,0],
  turnSub_target: [37,36,35,35,34,34,33,33,32,32,31,30],
  turnSub_actual: [36.11,0,0,0,0,0,0,0,0,0,0,0],

  // TCR
  tcrSCM_target: [1470000000,1580000000,1673000000,1993000000,2095000000,2016000000,2386000000,2336000000,2296000000,2448000000,2379000000,2328000000],
  tcrSCM_actual: [1951838821,0,0,0,0,0,0,0,0,0,0,0],
  tcrSCM_prevFinal: 7036136675,
  // TCR ì›ë£Œ ìƒì„¸
  tcrRaw_target: [1220000000,1330000000,1423000000,1693000000,1745000000,1666000000,2036000000,1986000000,1996000000,2198000000,2129000000,2078000000],
  tcrRaw_actual: [1751715484,0,0,0,0,0,0,0,0,0,0,0],
  tcrRaw_up:   [829801781,0,0,0,0,0,0,0,0,0,0,0],
  tcrRaw_down: [1271517265,0,0,0,0,0,0,0,0,0,0,0],
  tcrRaw_alt:  [1310000000,0,0,0,0,0,0,0,0,0,0,0],
  // TCR ë¶€ìì¬
  tcrSub_target: [250000000,250000000,250000000,300000000,350000000,350000000,350000000,350000000,300000000,250000000,250000000,250000000],
  tcrSub_actual: [200123337,0,0,0,0,0,0,0,0,0,0,0],

  // ë³´ìƒ
  compSCM_target: [175000000,175000000,180000000,230000000,230000000,230000000,230000000,230000000,230000000,230000000,230000000,180000000],
  compSCM_actual: [183214597,0,0,0,0,0,0,0,0,0,0,0],
  compSCM_prev: 3245354103,
  // ì‚¬ìš©ì†Œì§„
  consSCM_target: [500000000,500000000,600000000,600000000,700000000,800000000,800000000,700000000,700000000,700000000,700000000,700000000],
  consSCM_actual: [911472251,0,0,0,0,0,0,0,0,0,0,0],
  consSCM_prev: 9716816559,

  // ìì²´íê¸°
  dispSCM:  { prev: 2167254576, m: [119964282,0,0,0,0,0,0,0,0,0,0,0] },
  dispRaw:  { prev: 663797927,  m: [66764302,0,0,0,0,0,0,0,0,0,0,0] },
  dispSub:  { prev: 1503456649, m: [53199980,0,0,0,0,0,0,0,0,0,0,0] },

  // ì›ë‚©ê¸°ì¤€ìˆ˜ìœ¨
  ontimeSCM_target: 0.95,
  ontimeSCM_actual: [0.9541,0,0,0,0,0,0,0,0,0,0,0],
  ontimeSCM_prev: 0.9825,
  ontimeRaw_actual: [0.9994,0,0,0,0,0,0,0,0,0,0,0],
  ontimeRaw_prev: 1.0,
  ontimeSub_actual: [0.9547,0,0,0,0,0,0,0,0,0,0,0],
  ontimeSub_prev: 0.9825,
  ontimeTotal: 1742,
  ontimeRawFail: 1,
  ontimeSubFail: 79,

  // í•´ì™¸ë²•ì¸
  overseasActual: {
    shanghai:  { prev: 15305523706, m: [1644378577,0,0,0,0,0,0,0,0,0,0,0] },
    guangzhou: { prev: 5191341274,  m: [626413164,0,0,0,0,0,0,0,0,0,0,0] },
    nuworld:   { prev: 6304964152,  m: [991673734,0,0,0,0,0,0,0,0,0,0,0] },
    indo:      { prev: 8085223853,  m: [776146257,0,0,0,0,0,0,0,0,0,0,0] },
    thai:      { prev: 2636008529,  m: [144618735,0,0,0,0,0,0,0,0,0,0,0] },
  },
  overseasTarget: {
    shanghai:  [1154953587,1109334387,1206171887,1080716206,1007637226,884258645,929443335,907212935,1109334387,1359883367,1210182967,906788645],
    guangzhou: [266362810,251156410,251156410,255679064,214582517,246295571,228248644,205439044,251156410,292252956,269443356,246295571],
    nuworld:   [366847522,363045922,363045922,333843347,297037573,314033398,334337085,330535485,363045922,399851697,396050097,314033398],
    indo:      [272066240,264463040,264463040,251996200,216719760,242848120,216188740,253658940,263338040,298614480,287209680,391723120],
    thai:      [279999318,276197718,276197718,255060889,226320860,201382431,217653246,262726646,275072718,303812747,300011147,200257431],
  },
  overseasTotalTarget: [2340229476,2264197476,2361034976,2177295706,1962297935,1888818165,1925871050,1959573050,2261947476,2654415247,2462897247,2059098165],
  overseasTotalActual: [4183230467,0,0,0,0,0,0,0,0,0,0,0],

  // ë°œì£¼ê±´ìˆ˜
  orderTotal:  { prev: 176851, m: [16646,0,0,0,0,0,0,0,0,0,0,0] },
  orderRaw:    { prev: 68420,  m: [6451,0,0,0,0,0,0,0,0,0,0,0] },
  orderSub:    { prev: 108431, m: [10195,0,0,0,0,0,0,0,0,0,0,0] },
  orderByDept: { rawBiz: 1755, rawPur: 4696, pkgPur: 10195 },
  orderPerPerson: { rawPur: 469.6, pkgPur: 536.6 },
  headcount: { pkg1: 11, pkg2: 11, rawPur: 11, total: 33 },
};

// Utility
const toEok = v => (v / B).toFixed(0);
const toEok1 = v => (v / B).toFixed(1);
const pct = v => (v * 100).toFixed(1) + '%';
const num = v => Number(v).toLocaleString();
const activeMonths = data.scmInventory.m.filter(v => v > 0).length;

// ===== Chart.js defaults =====
Chart.defaults.color = '#6b7a8d';
Chart.defaults.borderColor = 'rgba(0,0,0,0.06)';
Chart.defaults.font.family = "'Noto Sans KR', sans-serif";
Chart.defaults.font.size = 10;
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.pointStyle = 'rectRounded';
Chart.defaults.plugins.legend.labels.pointStyleWidth = 10;
Chart.defaults.plugins.legend.labels.font = { size: 10 };
Chart.defaults.plugins.tooltip.backgroundColor = '#ffffff';
Chart.defaults.plugins.tooltip.titleColor = '#1a2332';
Chart.defaults.plugins.tooltip.bodyColor = '#1a2332';
Chart.defaults.plugins.tooltip.borderColor = '#e0e4e8';
Chart.defaults.plugins.tooltip.borderWidth = 1;
Chart.defaults.plugins.tooltip.cornerRadius = 6;
Chart.defaults.plugins.tooltip.padding = 8;

const noDataLabel = { id: 'noDataLabel', afterDraw(chart) {} };

// ===== KPI CARDS =====
function detailHtml(rows) {
  if (!rows || rows.length === 0) return '';
  return '<div class="kpi-detail">' + rows.map(r =>
    `<div class="kpi-detail-row"><span class="kpi-detail-label">${r[0]}</span><span class="kpi-detail-value">${r[1]}</span></div>`
  ).join('') + '</div>';
}

function renderKPIs() {
  const grid = document.getElementById('kpiGrid');
  // Raw/Sub data helpers
  const compRaw_target = 25000000, compRaw_actual = 11516960;
  const compSub_target = 150000000, compSub_actual = 171697637;

  const kpis = [
    {
      label: 'ì´ ì¬ê³ ê¸ˆì•¡ (1ì›”)',
      value: toEok(data.scmInventory.m[0]) + 'ì–µ',
      sub: 'ì „ë…„ë§ ' + toEok(data.scmInventory.prev) + 'ì–µ ëŒ€ë¹„',
      badge: data.scmInventory.m[0] > data.scmInventory.prev ? 'â–² ì¦ê°€' : 'â–¼ ê°ì†Œ',
      badgeClass: data.scmInventory.m[0] > data.scmInventory.prev ? 'badge-warn' : 'badge-good',
      accent: 'kpi-accent1', icon: 'ğŸ“¦', tab: 'inventory',
      detail: [
        ['ì›ë£Œ', toEok(data.rawInventory.m[0]) + 'ì–µ (ì „ë…„ ' + toEok(data.rawInventory.prev) + 'ì–µ)'],
        ['ë¶€ìì¬', toEok(data.subInventory.m[0]) + 'ì–µ (ì „ë…„ ' + toEok(data.subInventory.prev) + 'ì–µ)'],
      ]
    },
    {
      label: 'ë¶€ë™ì¬ê³  ë‹¬ì„±ë¥ ',
      value: pct(data.idleSCM_actual[0] / data.idleSCM_target[0]),
      sub: 'ëª©í‘œ ' + toEok(data.idleSCM_target[0]) + 'ì–µ / ì‹¤ì  ' + toEok(data.idleSCM_actual[0]) + 'ì–µ',
      badge: data.idleSCM_actual[0] <= data.idleSCM_target[0] ? 'ëª©í‘œ ì´ë‚´' : 'ëª©í‘œ ì´ˆê³¼',
      badgeClass: data.idleSCM_actual[0] <= data.idleSCM_target[0] ? 'badge-good' : 'badge-warn',
      accent: 'kpi-accent3', icon: 'ğŸ¯', tab: 'inventory',
      detail: [
        ['ì›ë£Œ', toEok(data.idleRaw_actual[0]) + 'ì–µ / ' + toEok(data.idleRaw_target[0]) + 'ì–µ (' + pct(data.idleRaw_actual[0]/data.idleRaw_target[0]) + ')'],
        ['ë¶€ìì¬', toEok(data.idleSub_actual[0]) + 'ì–µ / ' + toEok(data.idleSub_target[0]) + 'ì–µ (' + pct(data.idleSub_actual[0]/data.idleSub_target[0]) + ')'],
      ]
    },
    {
      label: 'TCR ë‹¬ì„±ë¥  (1ì›”)',
      value: pct(data.tcrSCM_actual[0] / data.tcrSCM_target[0]),
      sub: 'ëª©í‘œ ' + toEok(data.tcrSCM_target[0]) + 'ì–µ / ì‹¤ì  ' + toEok(data.tcrSCM_actual[0]) + 'ì–µ',
      badge: data.tcrSCM_actual[0] >= data.tcrSCM_target[0] ? 'ëª©í‘œ ë‹¬ì„±' : 'ë¯¸ë‹¬',
      badgeClass: data.tcrSCM_actual[0] >= data.tcrSCM_target[0] ? 'badge-good' : 'badge-bad',
      accent: 'kpi-accent2', icon: 'ğŸ’°', tab: 'tcr',
      detail: [
        ['ì›ë£Œ', toEok1(data.tcrRaw_actual[0]) + 'ì–µ / ' + toEok(data.tcrRaw_target[0]) + 'ì–µ (' + pct(data.tcrRaw_actual[0]/data.tcrRaw_target[0]) + ')'],
        ['ë¶€ìì¬', toEok1(data.tcrSub_actual[0]) + 'ì–µ / ' + toEok(data.tcrSub_target[0]) + 'ì–µ (' + pct(data.tcrSub_actual[0]/data.tcrSub_target[0]) + ')'],
      ]
    },
    {
      label: 'ì›ë‚©ê¸° ì¤€ìˆ˜ìœ¨ (1ì›”)',
      value: pct(data.ontimeSCM_actual[0]),
      sub: 'ëª©í‘œ 95.0% / ì „ë…„ ' + pct(data.ontimeSCM_prev),
      badge: data.ontimeSCM_actual[0] >= 0.95 ? 'ëª©í‘œ ë‹¬ì„±' : 'ë¯¸ë‹¬',
      badgeClass: data.ontimeSCM_actual[0] >= 0.95 ? 'badge-good' : 'badge-bad',
      accent: 'kpi-accent5', icon: 'â±', tab: 'etc',
      detail: [
        ['ì›ë£Œ', pct(data.ontimeRaw_actual[0]) + ' (ë¯¸ì¤€ìˆ˜ ' + data.ontimeRawFail + 'ê±´)'],
        ['ë¶€ìì¬', pct(data.ontimeSub_actual[0]) + ' (ë¯¸ì¤€ìˆ˜ ' + data.ontimeSubFail + 'ê±´)'],
      ]
    },
    {
      label: 'ì¬ê³ íšŒì „ì¼ (1ì›”)',
      value: data.turnSCM_actual[0].toFixed(1) + 'ì¼',
      sub: 'ëª©í‘œ ' + data.turnSCM_target[0].toFixed(1) + 'ì¼ / ì „ë…„ ' + data.turnSCM_prev.toFixed(1) + 'ì¼',
      badge: data.turnSCM_actual[0] <= data.turnSCM_target[0] ? 'ëª©í‘œ ë‹¬ì„±' : 'ê°œì„  í•„ìš”',
      badgeClass: data.turnSCM_actual[0] <= data.turnSCM_target[0] ? 'badge-good' : 'badge-warn',
      accent: 'kpi-accent1', icon: 'ğŸ”„', tab: 'inventory',
      detail: [
        ['ì›ë£Œ', data.turnRaw_actual[0].toFixed(1) + 'ì¼ (ëª©í‘œ ' + data.turnRaw_target[0].toFixed(1) + 'ì¼)'],
        ['ë¶€ìì¬', data.turnSub_actual[0].toFixed(1) + 'ì¼ (ëª©í‘œ ' + data.turnSub_target[0].toFixed(1) + 'ì¼)'],
      ]
    },
    {
      label: 'ë³´ìƒ ë‹¬ì„±ë¥  (1ì›”)',
      value: pct(data.compSCM_actual[0] / data.compSCM_target[0]),
      sub: 'ëª©í‘œ ' + toEok1(data.compSCM_target[0]) + 'ì–µ / ì‹¤ì  ' + toEok1(data.compSCM_actual[0]) + 'ì–µ',
      badge: data.compSCM_actual[0] >= data.compSCM_target[0] ? 'ëª©í‘œ ë‹¬ì„±' : 'ë¯¸ë‹¬',
      badgeClass: data.compSCM_actual[0] >= data.compSCM_target[0] ? 'badge-good' : 'badge-bad',
      accent: 'kpi-accent2', icon: 'ğŸ†', tab: 'comp',
      detail: [
        ['ì›ë£Œ', toEok1(compRaw_actual) + 'ì–µ / ' + toEok1(compRaw_target) + 'ì–µ (' + pct(compRaw_actual/compRaw_target) + ')'],
        ['ë¶€ìì¬', toEok1(compSub_actual) + 'ì–µ / ' + toEok1(compSub_target) + 'ì–µ (' + pct(compSub_actual/compSub_target) + ')'],
      ]
    },
    {
      label: 'í•´ì™¸ë²•ì¸ ë§¤ì¶œ (1ì›”)',
      value: toEok(data.overseasTotalActual[0]) + 'ì–µ',
      sub: 'ëª©í‘œ ' + toEok(data.overseasTotalTarget[0]) + 'ì–µ ëŒ€ë¹„',
      badge: data.overseasTotalActual[0] >= data.overseasTotalTarget[0] ? 'ëª©í‘œ ë‹¬ì„±' : 'ë¯¸ë‹¬',
      badgeClass: data.overseasTotalActual[0] >= data.overseasTotalTarget[0] ? 'badge-good' : 'badge-bad',
      accent: 'kpi-accent3', icon: 'ğŸŒ', tab: 'etc',
      detail: [
        ['ìƒí•´', toEok1(data.overseasActual.shanghai.m[0]) + 'ì–µ'],
        ['ê´‘ì €ìš°/ëˆ„ì›”ë“œ', toEok1(data.overseasActual.guangzhou.m[0]) + 'ì–µ / ' + toEok1(data.overseasActual.nuworld.m[0]) + 'ì–µ'],
        ['ì¸ë‹ˆ/íƒœêµ­', toEok1(data.overseasActual.indo.m[0]) + 'ì–µ / ' + toEok1(data.overseasActual.thai.m[0]) + 'ì–µ'],
      ]
    },
    {
      label: 'ë°œì£¼ê±´ìˆ˜ (1ì›”)',
      value: num(data.orderTotal.m[0]) + 'ê±´',
      sub: 'ì „ë…„ ì›”í‰ê·  ' + num(Math.round(data.orderTotal.prev / 12)) + 'ê±´',
      badge: data.orderTotal.m[0] > data.orderTotal.prev / 12 ? 'â–² ì¦ê°€' : 'â–¼ ê°ì†Œ',
      badgeClass: 'badge-warn',
      accent: 'kpi-accent4', icon: 'ğŸ“‹', tab: 'etc',
      detail: [
        ['ì›ë£Œ', num(data.orderRaw.m[0]) + 'ê±´ (ì „ë…„ ì›”í‰ê·  ' + num(Math.round(data.orderRaw.prev/12)) + 'ê±´)'],
        ['ë¶€ìì¬', num(data.orderSub.m[0]) + 'ê±´ (ì „ë…„ ì›”í‰ê·  ' + num(Math.round(data.orderSub.prev/12)) + 'ê±´)'],
      ]
    }
  ];
  grid.innerHTML = kpis.map(k => `
    <div class="kpi-card ${k.accent}" data-link="${k.tab}" style="cursor:pointer;" title="${k.label} ìƒì„¸ë³´ê¸°">
      <div class="kpi-icon">${k.icon}</div>
      <div class="kpi-label">${k.label}</div>
      <div class="kpi-value">${k.value}</div>
      <div class="kpi-sub">${k.sub}</div>
      <div class="kpi-badge ${k.badgeClass}">${k.badge}</div>
      ${detailHtml(k.detail)}
    </div>
  `).join('');
  grid.querySelectorAll('.kpi-card[data-link]').forEach(card => {
    card.addEventListener('click', () => switchTab(card.dataset.link));
  });
}

// ===== CHARTS =====

// 1. ì´ ì¬ê³ ê¸ˆì•¡ ì¶”ì´ (ì›ë£Œ+ë¶€ìì¬ ìŠ¤íƒ)
function chartInventoryTotal() {
  new Chart(document.getElementById('chartInventoryTotal'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        {
          label: 'ì›ë£Œ(2026)',
          data: data.rawInventory.m.map(v => v ? +(v/B).toFixed(1) : null),
          backgroundColor: 'rgba(25,118,210,0.65)',
          borderRadius: 2,
          stack: 'cur',
          barPercentage: 0.55,
        },
        {
          label: 'ë¶€ìì¬(2026)',
          data: data.subInventory.m.map(v => v ? +(v/B).toFixed(1) : null),
          backgroundColor: 'rgba(56,142,60,0.55)',
          borderRadius: 4,
          stack: 'cur',
          barPercentage: 0.55,
        },
        {
          label: 'ì „ë…„ í•©ê³„(2025)',
          data: data.scmInventory.prev_m.map(v => +(v/B).toFixed(1)),
          type: 'line',
          borderColor: 'rgba(255,152,0,0.8)',
          borderDash: [4,3],
          pointRadius: 3,
          pointBackgroundColor: 'rgba(255,152,0,0.8)',
          borderWidth: 2,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: {
        y: { stacked: true, title: { display: true, text: 'ì–µì›' } }
      }
    }
  });
}

// 1-1. ì›ë£Œ ì¬ê³ ê¸ˆì•¡ ì¶”ì´
function chartInvRaw() {
  new Chart(document.getElementById('chartInvRaw'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        {
          label: '2026 ì‹¤ì ',
          data: data.rawInventory.m.map(v => v ? +(v/B).toFixed(1) : null),
          backgroundColor: 'rgba(25,118,210,0.65)',
          borderRadius: 4,
          barPercentage: 0.6,
        },
        {
          label: '2025 ì‹¤ì ',
          data: data.rawInventory.prev_m.map(v => +(v/B).toFixed(1)),
          type: 'line',
          borderColor: 'rgba(255,152,0,0.8)',
          borderDash: [4,3],
          pointRadius: 3,
          pointBackgroundColor: 'rgba(255,152,0,0.8)',
          borderWidth: 2,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// 1-2. ë¶€ìì¬ ì¬ê³ ê¸ˆì•¡ ì¶”ì´
function chartInvSub() {
  new Chart(document.getElementById('chartInvSub'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        {
          label: '2026 ì‹¤ì ',
          data: data.subInventory.m.map(v => v ? +(v/B).toFixed(1) : null),
          backgroundColor: 'rgba(56,142,60,0.55)',
          borderRadius: 4,
          barPercentage: 0.6,
        },
        {
          label: '2025 ì‹¤ì ',
          data: data.subInventory.prev_m.map(v => +(v/B).toFixed(1)),
          type: 'line',
          borderColor: 'rgba(255,152,0,0.8)',
          borderDash: [4,3],
          pointRadius: 3,
          pointBackgroundColor: 'rgba(255,152,0,0.8)',
          borderWidth: 2,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// 2. ì¬ê³  êµ¬ì„±ë¹„ (ë„ë„›)
function chartInventoryCompo() {
  const normalVal = +(data.invNormal.m[0]/B).toFixed(0);
  const slowVal = +(data.invSlow.m[0]/B).toFixed(0);
  const deadVal = +(data.invDead.m[0]/B).toFixed(0);
  const totalVal = normalVal + slowVal + deadVal;
  new Chart(document.getElementById('chartInventoryCompo'), {
    type: 'doughnut',
    plugins: [ChartDataLabels],
    data: {
      labels: ['ì •ìƒ(~3ê°œì›”)', 'ë¶€ì§„(4~6ê°œì›”)', 'ë¶€ë™(7ê°œì›”~)'],
      datasets: [{
        data: [normalVal, slowVal, deadVal],
        backgroundColor: ['rgba(129,199,132,0.8)', 'rgba(255,183,77,0.8)', 'rgba(239,83,80,0.8)'],
        borderWidth: 0,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      cutout: '50%',
      layout: { padding: { top: 5, bottom: 0 } },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 10 }, padding: 10 } },
        tooltip: {
          callbacks: {
            label: ctx => ctx.label + ': ' + ctx.parsed + 'ì–µì› (' +
              (ctx.parsed / totalVal * 100).toFixed(1) + '%)'
          }
        },
        datalabels: {
          color: '#1a2332',
          font: { size: 10, weight: 600 },
          formatter: (val) => val + 'ì–µ (' + (val/totalVal*100).toFixed(1) + '%)',
          anchor: 'center',
          align: 'center',
          clamp: true,
        }
      }
    }
  });
}

// 2-1. ì›ë£Œ ì¬ê³  êµ¬ì„±ë¹„
function chartCompoRaw() {
  const nVal = +(data.rawNormal.m[0]/B).toFixed(0);
  const sVal = +(data.rawSlow.m[0]/B).toFixed(0);
  const dVal = +(data.rawDead.m[0]/B).toFixed(0);
  const tVal = nVal + sVal + dVal;
  new Chart(document.getElementById('chartCompoRaw'), {
    type: 'doughnut',
    plugins: [ChartDataLabels],
    data: {
      labels: ['ì •ìƒ(~3ê°œì›”)', 'ë¶€ì§„(4~6ê°œì›”)', 'ë¶€ë™(7ê°œì›”~)'],
      datasets: [{ data: [nVal, sVal, dVal], backgroundColor: ['rgba(129,199,132,0.8)', 'rgba(255,183,77,0.8)', 'rgba(239,83,80,0.8)'], borderWidth: 0 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '50%',
      layout: { padding: { top: 5, bottom: 0 } },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 10 }, padding: 10 } },
        tooltip: { callbacks: { label: ctx => ctx.label + ': ' + ctx.parsed + 'ì–µì› (' + (ctx.parsed/tVal*100).toFixed(1) + '%)' } },
        datalabels: { color: '#1a2332', font: { size: 10, weight: 600 }, formatter: (val) => val + 'ì–µ (' + (val/tVal*100).toFixed(1) + '%)', anchor: 'center', align: 'center', clamp: true }
      }
    }
  });
}

// 2-2. ë¶€ìì¬ ì¬ê³  êµ¬ì„±ë¹„
function chartCompoSub() {
  const nVal = +(data.subNormal.m[0]/B).toFixed(0);
  const sVal = +(data.subSlow.m[0]/B).toFixed(0);
  const dVal = +(data.subDead.m[0]/B).toFixed(0);
  const tVal = nVal + sVal + dVal;
  new Chart(document.getElementById('chartCompoSub'), {
    type: 'doughnut',
    plugins: [ChartDataLabels],
    data: {
      labels: ['ì •ìƒ(~3ê°œì›”)', 'ë¶€ì§„(4~6ê°œì›”)', 'ë¶€ë™(7ê°œì›”~)'],
      datasets: [{ data: [nVal, sVal, dVal], backgroundColor: ['rgba(129,199,132,0.8)', 'rgba(255,183,77,0.8)', 'rgba(239,83,80,0.8)'], borderWidth: 0 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '50%',
      layout: { padding: { top: 5, bottom: 0 } },
      plugins: {
        legend: { position: 'bottom', labels: { font: { size: 10 }, padding: 10 } },
        tooltip: { callbacks: { label: ctx => ctx.label + ': ' + ctx.parsed + 'ì–µì› (' + (ctx.parsed/tVal*100).toFixed(1) + '%)' } },
        datalabels: { color: '#1a2332', font: { size: 10, weight: 600 }, formatter: (val) => val + 'ì–µ (' + (val/tVal*100).toFixed(1) + '%)', anchor: 'center', align: 'center', clamp: true }
      }
    }
  });
}

// 3. êµ¬ë§¤ vs ì¶œê³ 
function chartPurchaseRelease() {
  const categories = ['SCM ì „ì²´', 'ì›ìì¬', 'ë¶€ìì¬'];
  new Chart(document.getElementById('chartPurchaseRelease'), {
    type: 'bar',
    data: {
      labels: categories,
      datasets: [
        {
          label: 'êµ¬ë§¤(1ì›”)',
          data: [data.scmPurchase.m[0]/B, data.rawPurchase.m[0]/B, data.subPurchase.m[0]/B].map(v=>+v.toFixed(0)),
          backgroundColor: 'rgba(79,195,247,0.7)',
          borderRadius: 4,
        },
        {
          label: 'ì¶œê³ (1ì›”)',
          data: [data.scmRelease.m[0]/B, data.rawRelease.m[0]/B, data.subRelease.m[0]/B].map(v=>+v.toFixed(0)),
          backgroundColor: 'rgba(129,199,132,0.7)',
          borderRadius: 4,
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { beginAtZero: true, title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// 4. ì›ìì¬/ë¶€ìì¬ ì¬ê³ 
function chartRawSub() {
  const labels = ['ì›ìì¬', 'ë¶€ìì¬'];
  new Chart(document.getElementById('chartRawSub'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        { label: 'ì •ìƒ', data: [data.rawNormal.m[0]/B, data.subNormal.m[0]/B].map(v=>+v.toFixed(0)), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4 },
        { label: 'ë¶€ì§„', data: [data.rawSlow.m[0]/B, data.subSlow.m[0]/B].map(v=>+v.toFixed(0)), backgroundColor: 'rgba(255,183,77,0.7)', borderRadius: 4 },
        { label: 'ë¶€ë™', data: [data.rawDead.m[0]/B, data.subDead.m[0]/B].map(v=>+v.toFixed(0)), backgroundColor: 'rgba(239,83,80,0.7)', borderRadius: 4 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { x: { stacked: true }, y: { stacked: true, title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// 5. ë¶€ë™ì¬ê³  SCM
function chartIdleInventory() {
  new Chart(document.getElementById('chartIdleInventory'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        {
          label: 'ëª©í‘œ',
          data: data.idleSCM_target.map(v => +(v/B).toFixed(1)),
          backgroundColor: 'rgba(79,195,247,0.3)',
          borderColor: 'rgba(79,195,247,0.8)',
          borderWidth: 1,
          borderRadius: 4,
          barPercentage: 0.7,
        },
        {
          label: 'ì‹¤ì ',
          data: data.idleSCM_actual.map(v => v ? +(v/B).toFixed(1) : null),
          backgroundColor: 'rgba(239,83,80,0.7)',
          borderRadius: 4,
          barPercentage: 0.7,
        },
        {
          label: 'ì „ë…„ë§',
          data: months.map(() => +(data.idleSCM_prevFinal/B).toFixed(1)),
          type: 'line',
          borderColor: 'rgba(186,104,200,0.8)',
          borderDash: [6,3],
          pointRadius: 0,
          borderWidth: 2,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' },
        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + 'ì–µì›' } }
      },
      scales: { y: { title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// ë¶€ë™ì¬ê³  ì›ë£Œ
function chartIdleRaw() {
  new Chart(document.getElementById('chartIdleRaw'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ëª©í‘œ', data: data.idleRaw_target.map(v => +(v/B).toFixed(1)), backgroundColor: 'rgba(79,195,247,0.3)', borderColor: 'rgba(79,195,247,0.7)', borderWidth: 1, borderRadius: 4, barPercentage: 0.6 },
        { label: 'ì‹¤ì ', data: data.idleRaw_actual.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4, barPercentage: 0.6 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { title: { display: true, text: 'ì–µì›' } } } }
  });
}

// ë¶€ë™ì¬ê³  ë¶€ìì¬
function chartIdleSub() {
  new Chart(document.getElementById('chartIdleSub'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ëª©í‘œ', data: data.idleSub_target.map(v => +(v/B).toFixed(1)), backgroundColor: 'rgba(79,195,247,0.3)', borderColor: 'rgba(79,195,247,0.7)', borderWidth: 1, borderRadius: 4, barPercentage: 0.6 },
        { label: 'ì‹¤ì ', data: data.idleSub_actual.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(255,183,77,0.7)', borderRadius: 4, barPercentage: 0.6 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { title: { display: true, text: 'ì–µì›' } } } }
  });
}

// ì¬ê³ íšŒì „ì¼
function chartTurnover() {
  new Chart(document.getElementById('chartTurnover'), {
    type: 'line',
    data: {
      labels: months,
      datasets: [
        { label: 'SCM ëª©í‘œ', data: data.turnSCM_target, borderColor: 'rgba(79,195,247,0.5)', borderDash: [6,3], pointRadius: 3, borderWidth: 2, fill: false },
        { label: 'SCM ì‹¤ì ', data: data.turnSCM_actual.map(v => v || null), borderColor: 'rgba(79,195,247,1)', pointRadius: 5, borderWidth: 3, fill: false },
        { label: 'ì›ë£Œ ëª©í‘œ', data: data.turnRaw_target, borderColor: 'rgba(129,199,132,0.5)', borderDash: [6,3], pointRadius: 3, borderWidth: 2, fill: false },
        { label: 'ì›ë£Œ ì‹¤ì ', data: data.turnRaw_actual.map(v => v || null), borderColor: 'rgba(129,199,132,1)', pointRadius: 5, borderWidth: 3, fill: false },
        { label: 'ë¶€ìì¬ ëª©í‘œ', data: data.turnSub_target, borderColor: 'rgba(255,183,77,0.5)', borderDash: [6,3], pointRadius: 3, borderWidth: 2, fill: false },
        { label: 'ë¶€ìì¬ ì‹¤ì ', data: data.turnSub_actual.map(v => v || null), borderColor: 'rgba(255,183,77,1)', pointRadius: 5, borderWidth: 3, fill: false },
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { title: { display: true, text: 'ì¼' }, min: 20 } }
    }
  });
}

// TCR ì „ì²´
function chartTCR() {
  new Chart(document.getElementById('chartTCR'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ëª©í‘œ', data: data.tcrSCM_target.map(v => +(v/B).toFixed(1)), backgroundColor: 'rgba(79,195,247,0.3)', borderColor: 'rgba(79,195,247,0.7)', borderWidth: 1, borderRadius: 4, barPercentage: 0.6 },
        { label: 'ì‹¤ì ', data: data.tcrSCM_actual.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4, barPercentage: 0.6 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { title: { display: true, text: 'ì–µì›' } } } }
  });
}

// TCR ì›ë£Œ ìƒì„¸
function chartTCRRaw() {
  new Chart(document.getElementById('chartTCRRaw'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ë‹¨ê°€ì¸í•˜', data: data.tcrRaw_down.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4, stack: 'actual' },
        { label: 'ëŒ€ì²´ì‹¤ì ', data: data.tcrRaw_alt.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(79,195,247,0.7)', borderRadius: 4, stack: 'actual' },
        { label: 'ë‹¨ê°€ì¸ìƒ(-)', data: data.tcrRaw_up.map(v => v ? -(v/B).toFixed(1) : null), backgroundColor: 'rgba(239,83,80,0.7)', borderRadius: 4, stack: 'actual' },
        { label: 'ëª©í‘œ', data: data.tcrRaw_target.map(v => +(v/B).toFixed(1)), type: 'line', borderColor: 'rgba(255,183,77,0.8)', borderDash: [4,2], pointRadius: 3, borderWidth: 2, fill: false }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { title: { display: true, text: 'ì–µì›' }, stacked: true } }
    }
  });
}

// ë³´ìƒ
function chartCompensation() {
  new Chart(document.getElementById('chartCompensation'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ëª©í‘œ', data: data.compSCM_target.map(v => +(v/B).toFixed(2)), backgroundColor: 'rgba(79,195,247,0.3)', borderColor: 'rgba(79,195,247,0.7)', borderWidth: 1, borderRadius: 4, barPercentage: 0.6 },
        { label: 'ì‹¤ì ', data: data.compSCM_actual.map(v => v ? +(v/B).toFixed(2) : null), backgroundColor: 'rgba(186,104,200,0.7)', borderRadius: 4, barPercentage: 0.6 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { title: { display: true, text: 'ì–µì›' } } } }
  });
}

// ì‚¬ìš©ì†Œì§„
function chartConsumption() {
  new Chart(document.getElementById('chartConsumption'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ëª©í‘œ', data: data.consSCM_target.map(v => +(v/B).toFixed(1)), backgroundColor: 'rgba(79,195,247,0.3)', borderColor: 'rgba(79,195,247,0.7)', borderWidth: 1, borderRadius: 4, barPercentage: 0.6 },
        { label: 'ì‹¤ì ', data: data.consSCM_actual.map(v => v ? +(v/B).toFixed(1) : null), backgroundColor: 'rgba(255,183,77,0.7)', borderRadius: 4, barPercentage: 0.6 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { title: { display: true, text: 'ì–µì›' } } } }
  });
}

// ìì²´íê¸°
function chartDisposal() {
  new Chart(document.getElementById('chartDisposal'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'ì›ë£Œ', data: data.dispRaw.m.map(v => v ? +(v/B).toFixed(2) : null), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4, stack: 's1' },
        { label: 'ë¶€ìì¬', data: data.dispSub.m.map(v => v ? +(v/B).toFixed(2) : null), backgroundColor: 'rgba(255,183,77,0.7)', borderRadius: 4, stack: 's1' },
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { stacked: true, title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// ì›ë‚©ê¸° ì¤€ìˆ˜ìœ¨
function chartOntime() {
  new Chart(document.getElementById('chartOntime'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [
        { label: 'SCM ì „ì²´', data: data.ontimeSCM_actual.map(v => v ? +(v*100).toFixed(1) : null), backgroundColor: 'rgba(79,195,247,0.7)', borderRadius: 4, barPercentage: 0.5 },
        { label: 'ì›ë£Œ', data: data.ontimeRaw_actual.map(v => v ? +(v*100).toFixed(1) : null), backgroundColor: 'rgba(129,199,132,0.7)', borderRadius: 4, barPercentage: 0.5 },
        { label: 'ë¶€ìì¬', data: data.ontimeSub_actual.map(v => v ? +(v*100).toFixed(1) : null), backgroundColor: 'rgba(255,183,77,0.7)', borderRadius: 4, barPercentage: 0.5 },
        { label: 'ëª©í‘œ(95%)', data: months.map(() => 95), type: 'line', borderColor: 'rgba(239,83,80,0.8)', borderDash: [6,3], pointRadius: 0, borderWidth: 2, fill: false }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { min: 90, max: 101, title: { display: true, text: '%' } } }
    }
  });
}

// ì›ë‚©ê¸° ë¯¸ì¤€ìˆ˜ ê±´ìˆ˜
function chartOntimeCount() {
  new Chart(document.getElementById('chartOntimeCount'), {
    type: 'bar',
    data: {
      labels: ['ì „ì²´ ê±´ìˆ˜', 'ì›ë£Œ ë¯¸ì¤€ìˆ˜', 'ë¶€ìì¬ ë¯¸ì¤€ìˆ˜'],
      datasets: [{
        data: [data.ontimeTotal, data.ontimeRawFail, data.ontimeSubFail],
        backgroundColor: ['rgba(79,195,247,0.7)', 'rgba(129,199,132,0.7)', 'rgba(255,183,77,0.7)'],
        borderRadius: 4,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false },
        tooltip: { callbacks: { label: ctx => ctx.parsed.y + 'ê±´' } }
      },
      scales: { y: { title: { display: true, text: 'ê±´' } } }
    }
  });
}

// í•´ì™¸ë²•ì¸ ë§¤ì¶œ
function chartOverseas() {
  const names = ['ìƒí•´', 'ê´‘ì €ìš°', 'ëˆ„ì›”ë“œ', 'ì¸ë‹ˆ', 'íƒœêµ­'];
  const keys = ['shanghai', 'guangzhou', 'nuworld', 'indo', 'thai'];
  const colors = ['rgba(79,195,247,0.7)', 'rgba(129,199,132,0.7)', 'rgba(255,183,77,0.7)', 'rgba(186,104,200,0.7)', 'rgba(239,83,80,0.7)'];

  const datasets = keys.map((k, i) => ({
    label: names[i],
    data: data.overseasActual[k].m.map(v => v ? +(v/B).toFixed(1) : null),
    backgroundColor: colors[i],
    borderRadius: 4,
    stack: 'actual',
  }));

  datasets.push({
    label: 'ëª©í‘œ í•©ê³„',
    data: data.overseasTotalTarget.map(v => +(v/B).toFixed(1)),
    type: 'line',
    borderColor: 'rgba(0,0,0,0.4)',
    borderDash: [6,3],
    pointRadius: 3,
    borderWidth: 2,
    fill: false,
  });

  new Chart(document.getElementById('chartOverseas'), {
    type: 'bar',
    data: { labels: months, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { stacked: true, title: { display: true, text: 'ì–µì›' } } }
    }
  });
}

// ë°œì£¼ê±´ìˆ˜
function chartOrders() {
  new Chart(document.getElementById('chartOrders'), {
    type: 'bar',
    data: {
      labels: ['ì›ë£Œì‚¬ì—…', 'ì›ë£Œêµ¬ë§¤', 'íŒ¨í‚¤ì§•êµ¬ë§¤'],
      datasets: [
        {
          label: '1ì›” ì‹¤ì ',
          data: [data.orderByDept.rawBiz, data.orderByDept.rawPur, data.orderByDept.pkgPur],
          backgroundColor: ['rgba(129,199,132,0.7)', 'rgba(79,195,247,0.7)', 'rgba(255,183,77,0.7)'],
          borderRadius: 4,
        }
      ]
    },
    options: {
      indexAxis: 'y',
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false },
        tooltip: { callbacks: { label: ctx => ctx.parsed.x.toLocaleString() + 'ê±´' } }
      },
      scales: { x: { title: { display: true, text: 'ê±´' } } }
    }
  });
}

// ì¸ë‹¹ ë°œì£¼ê±´ìˆ˜ + ì¸ì›
function chartHeadcount() {
  new Chart(document.getElementById('chartHeadcount'), {
    type: 'bar',
    data: {
      labels: ['íŒ¨í‚¤ì§•1íŒ€', 'íŒ¨í‚¤ì§•2íŒ€', 'ì›ë£Œêµ¬ë§¤íŒ€'],
      datasets: [
        {
          label: 'ì¸ì›(ëª…)',
          data: [data.headcount.pkg1, data.headcount.pkg2, data.headcount.rawPur],
          backgroundColor: 'rgba(79,195,247,0.7)',
          borderRadius: 4,
          yAxisID: 'y',
        },
        {
          label: 'ì¸ë‹¹ ë°œì£¼ê±´ìˆ˜',
          data: [data.orderPerPerson.pkgPur, data.orderPerPerson.pkgPur, data.orderPerPerson.rawPur],
          type: 'line',
          borderColor: 'rgba(255,183,77,1)',
          pointRadius: 5,
          borderWidth: 3,
          fill: false,
          yAxisID: 'y1',
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: {
        y: { title: { display: true, text: 'ëª…' }, position: 'left' },
        y1: { title: { display: true, text: 'ê±´/ì¸' }, position: 'right', grid: { drawOnChartArea: false } }
      }
    }
  });
}

// ===== TAB SYSTEM =====
const tabInits = {
  summary: () => { renderKPIs(); },
  inventory: () => { chartInventoryTotal(); chartInvRaw(); chartInvSub(); chartInventoryCompo(); chartCompoRaw(); chartCompoSub(); chartPurchaseRelease(); chartIdleInventory(); chartIdleRaw(); chartIdleSub(); chartTurnover(); },
  tcr: () => { chartTCR(); chartTCRRaw(); },
  comp: () => { chartCompensation(); chartConsumption(); },
  etc: () => { chartDisposal(); chartOntime(); chartOntimeCount(); chartOverseas(); chartOrders(); chartHeadcount(); },
};
const initialized = {};

function switchTab(tabId) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
  document.getElementById('panel-' + tabId).classList.add('active');
  if (!initialized[tabId]) {
    tabInits[tabId]();
    initialized[tabId] = true;
  }
}

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => switchTab(btn.dataset.tab));
});

// Init summary tab
switchTab('summary');

// ===== DOWNLOAD =====
function downloadSection(section) {
  const wb = XLSX.utils.book_new();
  const M = months;
  const hdr = ['êµ¬ë¶„','í•­ëª©','ì „ë…„ì‹¤ì ',...M];

  if (section === 'summary') {
    const rows = [hdr,
      ['ì´ ì¬ê³ ê¸ˆì•¡','SCM',+(data.scmInventory.prev/B).toFixed(1),...data.scmInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ',+(data.rawInventory.prev/B).toFixed(1),...data.rawInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ë¶€ìì¬',+(data.subInventory.prev/B).toFixed(1),...data.subInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['ë¶€ë™ì¬ê³  ëª©í‘œ','SCM',,...data.idleSCM_target.map(v=>+(v/B).toFixed(1))],
      ['ë¶€ë™ì¬ê³  ì‹¤ì ','SCM',+(data.idleSCM_prevFinal/B).toFixed(1),...data.idleSCM_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['TCR ëª©í‘œ','SCM',,...data.tcrSCM_target.map(v=>+(v/B).toFixed(1))],
      ['TCR ì‹¤ì ','SCM',+(data.tcrSCM_prevFinal/B).toFixed(1),...data.tcrSCM_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['ì›ë‚©ê¸°ì¤€ìˆ˜ìœ¨','ëª©í‘œ',data.ontimeSCM_target,...M.map(()=>data.ontimeSCM_target)],
      ['','SCMì‹¤ì ',data.ontimeSCM_prev,...data.ontimeSCM_actual.map(v=>v||'')],
      ['ì¬ê³ íšŒì „ì¼','ëª©í‘œ',,...data.turnSCM_target],
      ['','SCMì‹¤ì ',data.turnSCM_prev,...data.turnSCM_actual.map(v=>v||'')],
      ['ë°œì£¼ê±´ìˆ˜','SCM',data.orderTotal.prev,...data.orderTotal.m.map(v=>v||'')],
      ['','ì›ë£Œ',data.orderRaw.prev,...data.orderRaw.m.map(v=>v||'')],
      ['','ë¶€ìì¬',data.orderSub.prev,...data.orderSub.m.map(v=>v||'')],
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), 'ìš”ì•½');
  }

  if (section === 'inventory') {
    const rows = [hdr,
      ['ì´ êµ¬ë§¤ê¸ˆì•¡','SCM',+(data.scmPurchase.prev/B).toFixed(1),...data.scmPurchase.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['ì´ ì¶œê³ ê¸ˆì•¡','SCM',+(data.scmRelease.prev/B).toFixed(1),...data.scmRelease.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['ì´ ì¬ê³ ê¸ˆì•¡','SCM',+(data.scmInventory.prev/B).toFixed(1),...data.scmInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ',+(data.rawInventory.prev/B).toFixed(1),...data.rawInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ë¶€ìì¬',+(data.subInventory.prev/B).toFixed(1),...data.subInventory.m.map(v=>v?+(v/B).toFixed(1):'')],
      [],
      ['ì¬ê³ êµ¬ì„±(SCM)','ì •ìƒ',+(data.invNormal.prev/B).toFixed(0),...data.invNormal.m.map(v=>v?+(v/B).toFixed(0):'')],
      ['','ë¶€ì§„',+(data.invSlow.prev/B).toFixed(0),...data.invSlow.m.map(v=>v?+(v/B).toFixed(0):'')],
      ['','ë¶€ë™',+(data.invDead.prev/B).toFixed(0),...data.invDead.m.map(v=>v?+(v/B).toFixed(0):'')],
      [],
      ['ë¶€ë™ì¬ê³  ëª©í‘œ','SCM',,...data.idleSCM_target.map(v=>+(v/B).toFixed(1))],
      ['ë¶€ë™ì¬ê³  ì‹¤ì ','SCM',+(data.idleSCM_prevFinal/B).toFixed(1),...data.idleSCM_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ ëª©í‘œ',,...data.idleRaw_target.map(v=>+(v/B).toFixed(1))],
      ['','ì›ë£Œ ì‹¤ì ',,...data.idleRaw_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ë¶€ìì¬ ëª©í‘œ',,...data.idleSub_target.map(v=>+(v/B).toFixed(1))],
      ['','ë¶€ìì¬ ì‹¤ì ',,...data.idleSub_actual.map(v=>v?+(v/B).toFixed(1):'')],
      [],
      ['ì¬ê³ íšŒì „ì¼ ëª©í‘œ','SCM',,...data.turnSCM_target],
      ['ì¬ê³ íšŒì „ì¼ ì‹¤ì ','SCM',data.turnSCM_prev,...data.turnSCM_actual.map(v=>v||'')],
      ['','ì›ë£Œ ëª©í‘œ',,...data.turnRaw_target],
      ['','ì›ë£Œ ì‹¤ì ',,...data.turnRaw_actual.map(v=>v||'')],
      ['','ë¶€ìì¬ ëª©í‘œ',,...data.turnSub_target],
      ['','ë¶€ìì¬ ì‹¤ì ',,...data.turnSub_actual.map(v=>v||'')],
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), 'ì¬ê³ í˜„í™©');
  }

  if (section === 'tcr') {
    const rows = [hdr,
      ['TCR ëª©í‘œ','SCM',,...data.tcrSCM_target.map(v=>+(v/B).toFixed(1))],
      ['TCR ì‹¤ì ','SCM',+(data.tcrSCM_prevFinal/B).toFixed(1),...data.tcrSCM_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ ëª©í‘œ',,...data.tcrRaw_target.map(v=>+(v/B).toFixed(1))],
      ['','ì›ë£Œ ì‹¤ì ',,...data.tcrRaw_actual.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ ì¸ìƒ',,...data.tcrRaw_up.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ ì¸í•˜',,...data.tcrRaw_down.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì›ë£Œ ëŒ€ì²´',,...data.tcrRaw_alt.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ë¶€ìì¬ ëª©í‘œ',,...data.tcrSub_target.map(v=>+(v/B).toFixed(1))],
      ['','ë¶€ìì¬ ì‹¤ì ',,...data.tcrSub_actual.map(v=>v?+(v/B).toFixed(1):'')],
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), 'TCR');
  }

  if (section === 'comp') {
    const rows = [hdr,
      ['ë³´ìƒ ëª©í‘œ','SCM',,...data.compSCM_target.map(v=>+(v/B).toFixed(2))],
      ['ë³´ìƒ ì‹¤ì ','SCM',+(data.compSCM_prev/B).toFixed(1),...data.compSCM_actual.map(v=>v?+(v/B).toFixed(2):'')],
      ['ì‚¬ìš©ì†Œì§„ ëª©í‘œ','SCM(ë¶€ìì¬)',,...data.consSCM_target.map(v=>+(v/B).toFixed(1))],
      ['ì‚¬ìš©ì†Œì§„ ì‹¤ì ','SCM(ë¶€ìì¬)',+(data.consSCM_prev/B).toFixed(1),...data.consSCM_actual.map(v=>v?+(v/B).toFixed(1):'')],
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), 'ë³´ìƒ_ì‚¬ìš©ì†Œì§„');
  }

  if (section === 'etc') {
    const rows = [hdr,
      ['ìì²´íê¸°','SCM',+(data.dispSCM.prev/B).toFixed(1),...data.dispSCM.m.map(v=>v?+(v/B).toFixed(2):'')],
      ['','ì›ë£Œ',+(data.dispRaw.prev/B).toFixed(1),...data.dispRaw.m.map(v=>v?+(v/B).toFixed(2):'')],
      ['','ë¶€ìì¬',+(data.dispSub.prev/B).toFixed(1),...data.dispSub.m.map(v=>v?+(v/B).toFixed(2):'')],
      [],
      ['ì›ë‚©ê¸°ì¤€ìˆ˜ìœ¨','ëª©í‘œ',,...M.map(()=>data.ontimeSCM_target)],
      ['','SCMì‹¤ì ',data.ontimeSCM_prev,...data.ontimeSCM_actual.map(v=>v||'')],
      ['','ì›ë£Œì‹¤ì ',data.ontimeRaw_prev,...data.ontimeRaw_actual.map(v=>v||'')],
      ['','ë¶€ìì¬ì‹¤ì ',data.ontimeSub_prev,...data.ontimeSub_actual.map(v=>v||'')],
      ['','ì „ì²´ê±´ìˆ˜',,...[data.ontimeTotal,...Array(11).fill('')]],
      ['','ì›ë£Œë¯¸ì¤€ìˆ˜',,...[data.ontimeRawFail,...Array(11).fill('')]],
      ['','ë¶€ìì¬ë¯¸ì¤€ìˆ˜',,...[data.ontimeSubFail,...Array(11).fill('')]],
      [],
      ['í•´ì™¸ë²•ì¸','ìƒí•´',+(data.overseasActual.shanghai.prev/B).toFixed(1),...data.overseasActual.shanghai.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ê´‘ì €ìš°',+(data.overseasActual.guangzhou.prev/B).toFixed(1),...data.overseasActual.guangzhou.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ëˆ„ì›”ë“œ',+(data.overseasActual.nuworld.prev/B).toFixed(1),...data.overseasActual.nuworld.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','ì¸ë‹ˆ',+(data.overseasActual.indo.prev/B).toFixed(1),...data.overseasActual.indo.m.map(v=>v?+(v/B).toFixed(1):'')],
      ['','íƒœêµ­',+(data.overseasActual.thai.prev/B).toFixed(1),...data.overseasActual.thai.m.map(v=>v?+(v/B).toFixed(1):'')],
      [],
      ['ë°œì£¼ê±´ìˆ˜','SCM',data.orderTotal.prev,...data.orderTotal.m.map(v=>v||'')],
      ['','ì›ë£Œ',data.orderRaw.prev,...data.orderRaw.m.map(v=>v||'')],
      ['','ë¶€ìì¬',data.orderSub.prev,...data.orderSub.m.map(v=>v||'')],
    ];
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), 'ê¸°íƒ€');
  }

  const sectionNames = { summary:'ìš”ì•½', inventory:'ì¬ê³ í˜„í™©', tcr:'TCR', comp:'ë³´ìƒ_ì†Œì§„', etc:'ê¸°íƒ€' };
  XLSX.writeFile(wb, 'SCM_Dashboard_' + sectionNames[section] + '.xlsx');
}

// ===== UPLOAD =====
document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    try {
      const wb = XLSX.read(ev.target.result, { type: 'array' });
      const ws = wb.Sheets['SCM_26ë…„'];
      if (!ws) { alert('SCM_26ë…„ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
      const v = (r,c) => { const cell = ws[XLSX.utils.encode_cell({r:r-1,c:c-1})]; return cell ? (cell.v || 0) : 0; };
      // I=9 col(index8), J~T = cols 9~19 => row indices in sheet
      const colI = (row) => Array.from({length:12}, (_,i) => v(row, 9+i));

      // Update data from Excel
      data.scmPurchase.m = colI(5);
      data.scmRelease.m = colI(6);
      data.scmInventory.m = colI(11);
      data.invNormal.m = colI(12);
      data.invSlow.m = colI(13);
      data.invDead.m = colI(14);
      data.rawInventory.m = colI(22);
      data.rawNormal.m = colI(23);
      data.rawSlow.m = colI(24);
      data.rawDead.m = colI(25);
      data.rawPurchase.m = colI(16);
      data.rawRelease.m = colI(17);
      data.subInventory.m = colI(33);
      data.subNormal.m = colI(34);
      data.subSlow.m = colI(35);
      data.subDead.m = colI(36);
      data.subPurchase.m = colI(27);
      data.subRelease.m = colI(28);
      data.idleSCM_actual = colI(39);
      data.idleRaw_actual = colI(42);
      data.idleSub_actual = colI(45);
      data.turnSCM_actual = colI(48);
      data.turnRaw_actual = colI(51);
      data.turnSub_actual = colI(54);
      data.tcrSCM_actual = colI(76);
      data.tcrRaw_actual = colI(86);
      data.tcrRaw_up = colI(79);
      data.tcrRaw_down = colI(80);
      data.tcrRaw_alt = colI(82);
      data.tcrSub_actual = colI(93);
      data.compSCM_actual = colI(57);
      data.consSCM_actual = colI(66);
      data.dispSCM.m = colI(68);
      data.dispRaw.m = colI(69);
      data.dispSub.m = colI(70);
      data.ontimeSCM_actual = colI(96);
      data.ontimeRaw_actual = colI(99);
      data.ontimeSub_actual = colI(102);
      data.overseasActual.shanghai.m = colI(118);
      data.overseasActual.guangzhou.m = colI(119);
      data.overseasActual.nuworld.m = colI(120);
      data.overseasActual.indo.m = colI(121);
      data.overseasActual.thai.m = colI(122);
      data.overseasTotalActual = colI(123);
      data.orderTotal.m = colI(107);
      data.orderRaw.m = colI(108);
      data.orderSub.m = colI(109);

      // Destroy all existing charts and re-init
      Object.values(Chart.instances).forEach(c => c.destroy());
      Object.keys(initialized).forEach(k => delete initialized[k]);
      switchTab(document.querySelector('.tab-btn.active').dataset.tab);
      alert('ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch(err) {
      alert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + err.message);
    }
  };
  reader.readAsArrayBuffer(file);
  e.target.value = '';
});
</script>
</body>
</html>
